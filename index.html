<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <title>IF25 Terkece Biodata</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Berkshire+Swash&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <style>
/* --- 1. SETTING DASAR & WARNA --- */
        :root {
            --bg-gradient: transparent; 
            --text-color: #333;
            --card-bg: rgba(230, 230, 254, 0.9); /* Opacity ditingkatkan sedikit untuk mengurangi beban backdrop-filter */
            --nim-bg: #ecf0f1;
            --nim-text: #2c3e50;
            --fixed-bg: rgba(255, 255, 255, 0.9);
            --fixed-text: #2c3e50;
            --firefly-color: #ffeb3b; 
            --glow-color: rgba(52, 152, 219, 0.3); 
        }

        body.dark-mode {
            --text-color: #e0e0e0;
            --card-bg: rgba(43, 63, 118, 0.9); 
            --nim-bg: #1a1a2e;
            --nim-text: #bdc3c7;
            --fixed-bg: rgba(15, 52, 96, 0.9);
            --fixed-text: #e0e0e0;
            --firefly-color: #76ff03;
            --glow-color: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            min-height: 100vh; 
            overflow-x: hidden; 
            position: relative;
            background-color: #f0f0f0;
            -webkit-tap-highlight-color: transparent; /* Hilangkan highlight tap di mobile */
        }

/* =========================================
   OPTIMIZED BACKGROUND SYSTEMS
   ========================================= */

        .global-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -9999;
            overflow: hidden;
            pointer-events: none;
            transform: translateZ(0); /* Hardware Acceleration */
        }

        /* --- LIGHT MODE OPTIMIZED (Gradients instead of Blur) --- */
        #bg-light-mode {
            background-color: #000510;
            background-image: linear-gradient(135deg, #001233 0%, #003060 100%);
            display: block;
        }
        
        body.dark-mode #bg-light-mode { display: none; }

        .glow {
            position: absolute; border-radius: 50%;
            opacity: 0.6; mix-blend-mode: screen;
            /* Performance Fix: Ganti filter blur dengan radial gradient */
            filter: none !important; 
        }
        
        .glow-1 {
            width: 80vw; height: 80vh; 
            background: radial-gradient(circle, rgba(0, 255, 242, 0.4) 0%, transparent 70%);
            bottom: -20%; left: -20%; 
            animation: drift 10s infinite alternate ease-in-out;
            will-change: transform; /* Hint to browser */
        }
        .glow-2 {
            width: 90vw; height: 70vh; 
            background: radial-gradient(circle, rgba(0, 97, 255, 0.4) 0%, transparent 70%);
            top: -10%; right: -10%; 
            animation: drift 15s infinite alternate-reverse ease-in-out;
            will-change: transform;
        }
        .glow-3 {
            width: 100vw; height: 40vh;
            background: radial-gradient(ellipse, rgba(0, 255, 234, 0.3) 0%, transparent 70%);
            top: 30%; left: 10%; 
            animation: drift 20s infinite alternate ease-in-out;
            will-change: transform;
        }

        /* Stars Static - CSS Only Optimization */
        .stars-bg, .stars-sm-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-repeat: repeat;
            opacity: 0.5;
        }
        
        /* Menggunakan background image simple daripada ribuan div */
        .stars-bg {
            background-image: radial-gradient(white 1px, transparent 1px);
            background-size: 50px 50px;
        }

        @keyframes drift {
            0% { transform: translate(0, 0); }
            100% { transform: translate(20px, -20px); }
        }

        /* --- DARK MODE OPTIMIZED --- */
        #bg-dark-mode {
            background: radial-gradient(ellipse at bottom, #0B1026 0%, #000000 100%);
            display: none;
        }
        body.dark-mode #bg-dark-mode { display: block; }

        .star-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: transparent; will-change: transform;
        }
        
        /* Meteor Optimized */
        .meteor {
            position: absolute; opacity: 0; 
            pointer-events: none; z-index: 10;
            background: linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%);
            will-change: transform, opacity;
        }
        @keyframes shooting {
            0% { transform: translate(0, 0) rotate(-45deg); opacity: 1; }
            100% { transform: translate(-100vw, 100vw) rotate(-45deg); opacity: 0; }
        }

/* =========================================
   LAYOUT & UI ELEMENTS
   ========================================= */

        #profile-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; 
            display: none; opacity: 0;
            transition: opacity 0.3s ease; overflow-y: auto; 
            background: rgba(0,0,0,0.95); /* Ubah ke solid transparan agar render lebih ringan */
            will-change: opacity;
        }

        .profile-content { 
            position: relative; z-index: 5; 
            width: 100%; min-height: 100%; 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            padding: 80px 20px 40px 20px; 
        }

        .fixed-element {
            position: fixed; top: 20px; z-index: 1000;
            background: var(--fixed-bg); padding: 10px 20px;
            border-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            /* PERFORMANCE: Hapus backdrop-filter di mobile jika berat */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            color: var(--fixed-text);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none; font-size: 14px; font-weight: 600;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .pos-left { left: 20px; }
        .pos-right { right: 20px; }
        .pos-theme { right: 180px; width: 45px; height: 45px; padding: 0; cursor: pointer; border: none; font-size: 18px; }
        .pos-right i { color: #ff0000; font-size: 18px; margin-right: 8px; }
        .pos-theme i { color: #f1c40f; }
        body.dark-mode .pos-theme i { color: #f39c12; }

        .event-box {
            position: fixed; top: 70px; left: 20px; z-index: 999;
            background: linear-gradient(135deg, #ffd700 0%, #2ecc71 100%);
            padding: 8px 20px; border-radius: 30px;
            color: #fff; font-size: 13px; font-weight: 700;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
            cursor: pointer; overflow: hidden; 
            border: 2px solid rgba(255,255,255,0.3);
            display: flex; align-items: center; gap: 8px;
        }

        /* --- NOW PLAYING BOX --- */
        .now-playing-box {
            position: fixed; bottom: 20px; right: 0; z-index: 9999;
            background: var(--fixed-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px; padding-right: 20px;
            border-top-left-radius: 50px; border-bottom-left-radius: 50px;
            box-shadow: -5px 5px 20px rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 15px;
            width: 300px; 
            transform: translateX(calc(100% - 50px)); 
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .now-playing-box.expanded { transform: translateX(0); }
        
        .np-icon {
            width: 35px; height: 35px; flex-shrink: 0;
            background: #e91e63; color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 14px; 
            animation: spin 3s linear infinite;
            cursor: pointer; position: relative; z-index: 2;
        }
        .np-content {
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; overflow: hidden; opacity: 0; transition: opacity 0.2s;
        }
        .now-playing-box.expanded .np-content { opacity: 1; transition-delay: 0.2s; }
        .np-info { display: flex; flex-direction: column; overflow: hidden; max-width: 140px; }
        .np-label { font-size: 9px; opacity: 0.7; }
        .np-title { font-size: 12px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .np-controls { display: flex; gap: 8px; }
        .np-btn { width: 28px; height: 28px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.1); color: var(--text-color); }

        /* --- PLAYLIST BOX --- */
        .playlist-box {
            position: fixed; bottom: 80px; right: 20px;
            width: 280px; max-height: 400px;
            background: var(--card-bg); border-radius: 15px;
            z-index: 9998; padding: 3px;
            opacity: 0; visibility: hidden; transform: translateY(20px);
            transition: 0.3s;
        }
        .playlist-box.show { opacity: 1; visibility: visible; transform: translateY(0); }
        .playlist-inner { background: var(--card-bg); width: 100%; height: 100%; border-radius: 12px; display: flex; flex-direction: column; }
        .playlist-scroll { padding: 10px; overflow-y: auto; max-height: 300px; }
        .track-item { display: flex; gap: 10px; padding: 8px; border-radius: 8px; cursor: pointer; align-items: center; margin-bottom: 5px; }
        .track-item:hover { background: rgba(0,0,0,0.1); }
        .track-item.playing { background: rgba(52, 152, 219, 0.2); border-left: 3px solid #3498db; }
        .track-name { font-size: 12px; font-weight: 600; }

        /* --- MAIN CONTENT --- */
        #main-view { position: relative; z-index: 10; transition: opacity 0.5s; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 120px 20px 40px 20px; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { font-family: 'Berkshire Swash', cursive; color: #ff0000; font-size: 3rem; margin-bottom: 5px; }
        .search-box { width: 100%; max-width: 500px; margin: 0 auto 30px auto; }
        .search-box input { width: 100%; padding: 15px 25px; border-radius: 50px; border: none; background: var(--card-bg); color: var(--text-color); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        
        /* Optimized Card */
        .card {
            background: var(--card-bg); 
            border-radius: 15px; padding: 25px; text-align: center; 
            border-top: 5px solid transparent; cursor: pointer;
            position: relative; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
            transition: transform 0.2s ease;
            /* Performance: Hapus backdrop filter di card */
            backdrop-filter: none; -webkit-backdrop-filter: none;
            content-visibility: auto; /* Browser Optimization */
        }
        .card:hover { transform: translateY(-5px); border-top: 5px solid #3498db; }
        .card.hidden-card { display: none; } 

        .avatar { width: 65px; height: 65px; background: #ddd; border-radius: 50%; margin: 0 auto 10px auto; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 22px; color: #555; }
        .card h3 { font-size: 17px; font-weight: 600; color: var(--text-color); margin-bottom: 5px; }
        .nim-badge { background: var(--nim-bg); color: var(--nim-text); padding: 4px 12px; border-radius: 15px; font-size: 13px; }

        /* Special Cards Colors */
        .card.owner-card { background: linear-gradient(45deg, #059669, #10b981); color: white !important; }
        .card.ketua-card { background: linear-gradient(135deg, #2980b9, #6dd5fa); color: white !important; }
        /* Add other roles colors as needed based on original */

        /* --- MODALS --- */
        .modal-overlay, .jodoh-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85);
            z-index: 5000; display: flex; align-items: center; justify-content: center; flex-direction: column;
            opacity: 0; visibility: hidden; transition: 0.2s; /* Percepat transisi */
        }
        .active { opacity: 1; visibility: visible; }
        .modal-box { background: var(--card-bg); padding: 30px; border-radius: 20px; text-align: center; max-width: 90%; width: 400px; transform: scale(0.95); transition: transform 0.2s; }
        .active .modal-box { transform: scale(1); }

        .choice-btn { padding: 15px 30px; border: none; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; color: white; margin: 0 10px; }
        .btn-if1 { background: #667eea; }
        .btn-if2 { background: #ff9966; }

        /* --- MOBILE OPTIMIZATIONS --- */
        .mobile-layout-controls {
            display: none; position: fixed; top: 75px; left: 50%; transform: translateX(-50%);
            z-index: 990; background: var(--fixed-bg); padding: 4px; border-radius: 50px;
        }
        .mobile-btn { padding: 6px 15px; border-radius: 20px; border: none; background: transparent; cursor: pointer; font-size: 12px; font-weight: bold; }
        .mobile-btn.active { background: #3498db; color: white; }

        @media (max-width: 600px) {
            .mobile-layout-controls { display: flex; }
            .grid-container { grid-template-columns: 1fr; padding: 0 10px; }
            .grid-container.mobile-grid-active { grid-template-columns: repeat(2, 1fr) !important; gap: 10px; }
            
            /* Sembunyikan elemen background berat di HP */
            .glow, .meteor { display: none !important; } 
            
            /* Ganti dengan background static ringan */
            body { background: linear-gradient(to bottom, #f0f0f0, #e0e0e0); }
            body.dark-mode { background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364); }
            
            h1 { font-size: 1.8rem; }
            .now-playing-box { bottom: 70px; max-width: 250px; }
            .fixed-element { font-size: 10px; padding: 8px 12px; }
            .pos-theme { right: 55px; }
        }

        /* --- HELPERS --- */
        .big-profile-card { background: var(--card-bg); padding: 30px; border-radius: 20px; width: 100%; max-width: 400px; text-align: center; color: var(--text-color); margin: 0 auto; }
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.1); font-size: 14px; }
        .big-avatar { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 15px; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="global-bg" id="bg-light-mode">
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>
    <div class="glow glow-3"></div>
    <div class="stars-bg"></div>
</div>

<div class="global-bg" id="bg-dark-mode">
    <div class="star-layer" id="stars-container"></div>
</div>

<div id="copy-tooltip" style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(0,0,0,0.8); color:white; padding:10px 20px; border-radius:20px; z-index:5000; opacity:0; pointer-events:none; transition:0.3s;">NIM Disalin!</div>

<div id="playlist-box" class="playlist-box">
    <div class="playlist-inner">
        <div style="padding:10px; border-bottom:1px solid #ccc; font-weight:bold;">Daftar Lagu</div>
        <div class="playlist-scroll" id="playlist-container"></div>
    </div>
</div>

<div id="now-playing-box" class="now-playing-box">
    <div class="np-icon" onclick="toggleNPBox()"><i class="fas fa-music"></i></div>
    <div class="np-content">
        <div class="np-info">
            <div class="np-label">Sedang Memutar</div>
            <div class="np-title" id="np-title">Menunggu Lagu...</div>
        </div>
        <div class="np-controls">
            <button class="np-btn" id="btn-playlist-toggle" onclick="togglePlaylist()"><i class="fas fa-list"></i></button>
            <button class="np-btn" onclick="toggleMute()"><i class="fas fa-volume-up" id="mute-icon"></i></button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="selectionModal">
    <div class="modal-box">
        <h2 style="margin-bottom:20px; color:var(--text-color);">Mau Liat Kelas IF Berapa?</h2>
        <div style="display:flex; justify-content:center;">
            <button class="choice-btn btn-if1" onclick="loadClassData('IF1')">IF 1</button>
            <button class="choice-btn btn-if2" onclick="loadClassData('IF2')">IF 2</button>
        </div>
    </div>
</div>

<div class="mobile-layout-controls">
    <button class="mobile-btn active" onclick="setMobileList()" id="btnList"><i class="fas fa-list"></i> List</button>
    <button class="mobile-btn" onclick="setMobileGrid()" id="btnGrid"><i class="fas fa-th-large"></i> Petak</button>
</div>

<div id="main-view">
    <div class="fixed-element pos-left">Karya: Gilang Aidil Pratama</div>
    <div class="event-box" onclick="alert('Fitur Event (Steganography) akan segera aktif!')">
        <i class="fas fa-trophy"></i> Event
    </div>

    <button class="fixed-element pos-theme" id="themeToggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
    <a href="http://www.youtube.com/@DilzGhaaziy" target="_blank" class="fixed-element pos-right"><i class="fab fa-youtube"></i><span>Dilz Ghaaziy</span></a>

    <div class="container">
        <header>
            <h1>Daftar Mahasiswa</h1>
            <p style="color:#888; margin-bottom:20px;"><span id="class-name">Kelas</span> &bull; Cihuyyy</p>
            <div class="search-box">
                <input type="text" id="searchInput" onkeyup="filterNames()" placeholder="Cari nama atau NIM...">
            </div>
        </header>
        <div class="grid-container" id="cardGrid"></div>
    </div>
</div>

<div id="profile-view">
    <button onclick="closeProfile()" style="position:absolute; top:20px; left:20px; padding:10px 20px; border-radius:20px; border:none; background:white; font-weight:bold; cursor:pointer; z-index:2005;">&larr; Kembali</button>
    <div class="profile-content">
        <div class="big-profile-card">
            <div class="big-avatar" id="p-avatar">GA</div>
            <h2 id="p-name">Nama</h2>
            <p id="p-nim" onclick="copyNIM()" style="cursor:pointer; opacity:0.7;">NIM (Klik Salin)</p>
            <hr style="margin:15px 0; border:0; border-top:1px solid rgba(0,0,0,0.1);">
            <div class="info-row"><span>Angkatan</span><span>2025</span></div>
            <div class="info-row"><span>Kelas</span><span id="p-class">-</span></div>
            <div class="info-row"><span>Gender</span><span id="p-gender">-</span></div>
            <div class="info-row"><span>Tgl Lahir</span><span id="p-dob">-</span></div>
            
            <button onclick="cekJodoh()" style="width:100%; padding:15px; margin-top:20px; border-radius:50px; border:none; background:linear-gradient(90deg, #ff512f, #dd2476); color:white; font-weight:bold; cursor:pointer;">
                <i class="fas fa-heart"></i> Cek Jodoh
            </button>
        </div>
    </div>
</div>

<div class="jodoh-modal" id="jodohModal">
    <div class="modal-box">
        <h2 style="color:var(--text-color)">Jodoh Kamu Adalah...</h2>
        <h1 id="jodoh-result" style="margin:20px 0; color:#e91e63;">Mencari...</h1>
        <div id="jodoh-loading">Sedang menghitung algoritma cinta...</div>
        <button onclick="closeJodoh()" style="margin-top:20px; padding:10px 20px; border:none; background:#333; color:white; border-radius:20px; cursor:pointer;">Tutup</button>
    </div>
</div>

<script>
    // --- 1. PERFORMANCE OPTIMIZATION: POPUP MUNCUL DULUAN ---
    document.addEventListener("DOMContentLoaded", function() {
        // Langsung munculkan modal tanpa menunggu gambar/font
        document.getElementById('selectionModal').classList.add('active');
        
        // Cek Tema
        if(localStorage.getItem('theme')==='dark') { 
            document.body.classList.add('dark-mode'); 
            document.querySelector('#themeToggle i').classList.replace('fa-moon','fa-sun'); 
        }
        
        // Generate bintang ringan untuk dark mode
        initLiteStars();
    });

    // --- 2. DATA DUMMY (FALLBACK JIKA FETCH GAGAL/LAMBAT) ---
    // Agar user tetap bisa lihat sesuatu meskipun internet lambat
    let dataIF1 = [
        {name: "Gilang Aidil Pratama", nim: "250001", gender: "L", isOwner: true, dob: "27 Mei"},
        {name: "Aisyah Nur Syifa", nim: "250002", gender: "P", role: "Sekretaris", dob: "12 Agt"},
        {name: "Contoh Mahasiswa 1", nim: "250003", gender: "L", dob: "1 Jan"}
    ];
    let dataIF2 = [
        {name: "Mahasiswa IF2 A", nim: "250099", gender: "P", dob: "1 Feb"}
    ];
    let allStudents = [...dataIF1, ...dataIF2];

    // --- 3. FETCH DATA ASYNC (TIDAK MEMBLOKIR UI) ---
    async function fetchStudentData() {
        try {
            // Ganti 'students.json' dengan file asli Anda
            const response = await fetch('students.json?t=' + new Date().getTime());
            if (!response.ok) throw new Error("Gagal");
            const data = await response.json();
            dataIF1 = data.IF1 || dataIF1;
            dataIF2 = data.IF2 || dataIF2;
            allStudents = [...dataIF1.map(s=>({...s, class:'IF 1'})), ...dataIF2.map(s=>({...s, class:'IF 2'}))];
            console.log("Data Loaded");
        } catch (e) {
            console.log("Using fallback data");
        }
    }
    // Panggil fetch setelah UI utama siap
    window.onload = function() {
        fetchStudentData();
        // Preload Audio Ringan
        setTimeout(preloadAudio, 2000); 
    };

    // --- 4. OPTIMIZED STAR GENERATOR ---
    function initLiteStars() {
        const container = document.getElementById('stars-container');
        if (!container) return;
        
        // Kurangi jumlah bintang drastis di HP
        const isMobile = window.innerWidth < 600;
        const count = isMobile ? 30 : 100; 

        let boxShadows = [];
        for(let i=0; i<count; i++){
            const x = Math.floor(Math.random() * window.innerWidth);
            const y = Math.floor(Math.random() * window.innerHeight);
            boxShadows.push(`${x}px ${y}px #FFF`);
        }
        
        const star = document.createElement('div');
        star.style.width = '2px'; star.style.height = '2px';
        star.style.background = 'transparent';
        star.style.boxShadow = boxShadows.join(', ');
        container.appendChild(star);
    }

    // --- 5. CORE LOGIC (UI INTERACTION) ---
    let currentClassLabel = "";
    let userInteracted = false;

    function loadClassData(type) {
        if(!userInteracted) { userInteracted = true; tryPlayMusic(); }
        
        document.getElementById('selectionModal').classList.remove('active');
        const grid = document.getElementById('cardGrid');
        grid.innerHTML = "";
        
        const data = (type === 'IF1') ? dataIF1 : dataIF2;
        currentClassLabel = (type === 'IF1') ? "IF 1" : "IF 2";
        document.getElementById('class-name').innerText = currentClassLabel;

        // Gunakan Fragment untuk meminimalkan Repaint Browser (Lebih Cepat)
        const fragment = document.createDocumentFragment();

        data.forEach((s, idx) => {
            const el = document.createElement('div');
            let extraClass = '';
            if(s.isOwner) extraClass = 'owner-card';
            else if(s.role && s.role.includes('Ketua')) extraClass = 'ketua-card';

            el.className = `card ${extraClass}`;
            el.innerHTML = `
                <div class="avatar">${getInitials(s.name)}</div>
                <h3>${s.name}</h3>
                <span class="nim-badge">${s.nim}</span>
            `;
            // Simpan data di properti element biar gak perlu lookup array lagi
            el.studentData = s; 
            el.onclick = function() { openProfile(this.studentData); };
            fragment.appendChild(el);
        });
        
        grid.appendChild(fragment);
    }

    function openProfile(s) {
        document.getElementById('p-name').innerText = s.name;
        document.getElementById('p-nim').innerText = s.nim;
        document.getElementById('p-class').innerText = currentClassLabel;
        document.getElementById('p-gender').innerText = s.gender;
        document.getElementById('p-dob').innerText = s.dob || "-";
        document.getElementById('p-avatar').innerText = getInitials(s.name);
        
        // Transisi halus
        const mv = document.getElementById('main-view');
        const pv = document.getElementById('profile-view');
        mv.style.opacity = 0;
        setTimeout(() => {
            mv.style.display = 'none';
            pv.style.display = 'block';
            setTimeout(() => pv.style.opacity = 1, 50);
        }, 300);
    }

    function closeProfile() {
        const mv = document.getElementById('main-view');
        const pv = document.getElementById('profile-view');
        pv.style.opacity = 0;
        setTimeout(() => {
            pv.style.display = 'none';
            mv.style.display = 'block';
            setTimeout(() => mv.style.opacity = 1, 50);
        }, 300);
    }

    // --- 6. AUDIO PLAYER (OPTIMIZED) ---
    let audio = new Audio();
    const playlist = [
        {title: "DBFM Radio", url: "https://pu.klikhost.com/proxy/dbfm/stream"},
        {title: "Instrumen Santuy", url: "https://stream.radiojar.com/4ywdgup3bnzuv"} // Fallback ringan
    ];
    let isMuted = false;

    function preloadAudio() {
        // Hanya set src, jangan load full
        audio.src = playlist[0].url; 
        audio.preload = 'none';
    }

    function tryPlayMusic() {
        audio.play().then(() => {
            updateNP(playlist[0].title);
        }).catch(() => console.log("Autoplay blocked"));
    }

    function updateNP(title) {
        document.getElementById('np-title').innerText = title;
        const box = document.getElementById('now-playing-box');
        box.classList.add('expanded');
        setTimeout(() => box.classList.remove('expanded'), 5000);
    }
    
    function toggleNPBox() { document.getElementById('now-playing-box').classList.toggle('expanded'); }
    function toggleMute() {
        isMuted = !isMuted; audio.muted = isMuted;
        document.getElementById('mute-icon').className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
    }

    // --- 7. UTILS & FITUR LAIN ---
    function getInitials(n) { return n.substring(0,2).toUpperCase(); }
    
    // Search dengan Debounce (Supaya gak lag saat ngetik)
    let searchTimeout;
    function filterNames() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            const val = document.getElementById('searchInput').value.toUpperCase();
            const cards = document.querySelectorAll('.card');
            cards.forEach(c => {
                const txt = c.innerText.toUpperCase();
                c.style.display = txt.includes(val) ? 'block' : 'none';
            });
        }, 300); // Tunggu 300ms setelah user berhenti ngetik
    }

    function cekJodoh() {
        document.getElementById('jodohModal').classList.add('active');
        const el = document.getElementById('jodoh-result');
        const load = document.getElementById('jodoh-loading');
        el.innerText = "Mencari...";
        load.style.display = 'block';
        
        setTimeout(() => {
            const random = allStudents[Math.floor(Math.random() * allStudents.length)];
            el.innerText = random.name;
            load.style.display = 'none';
        }, 2000);
    }
    
    function closeJodoh() { document.getElementById('jodohModal').classList.remove('active'); }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode')?'dark':'light');
        document.querySelector('#themeToggle i').className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
    }

    function copyNIM() {
        const txt = document.getElementById('p-nim').innerText;
        navigator.clipboard.writeText(txt);
        const t = document.getElementById('copy-tooltip');
        t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 1500);
    }

    function setMobileList() {
        document.getElementById('cardGrid').classList.remove('mobile-grid-active');
        document.getElementById('btnList').classList.add('active');
        document.getElementById('btnGrid').classList.remove('active');
    }
    function setMobileGrid() {
        document.getElementById('cardGrid').classList.add('mobile-grid-active');
        document.getElementById('btnGrid').classList.add('active');
        document.getElementById('btnList').classList.remove('active');
    }

</script>
</body>
</html>
